<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Akıllı Planlayıcı</title>

<style>
html { font-size: 16px; }
:root {
    --bg-color: #f4f6f8;
    --card-bg: #ffffff;
    --text-color: #333;
    --primary-color: #6200ea;
    --accent-color: #4CAF50;
    --danger-color: #f44336;
    --input-border: #e2e8f0;
}
body.dark-mode {
    --bg-color: #121212;
    --card-bg: #1e1e1e;
    --text-color: #e0e0e0;
    --primary-color: #bb86fc;
}

body {
    font-family: 'Segoe UI', sans-serif;
    background: var(--bg-color);
    color: var(--text-color);
    padding: 2rem;
    max-width: 600px;
    margin: auto;
}

.header {
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:1.5rem;
}

.form-container {
    background:var(--card-bg);
    padding:1.5rem;
    border-radius:20px;
    box-shadow:0 10px 25px rgba(0,0,0,0.08);
    margin-bottom:1.5rem;
}

.input-group {
    display:flex;
    flex-direction:column;
    gap:0.8rem;
}

input, select {
    padding:0.85rem;
    border-radius:12px;
    border:2px solid var(--input-border);
    background:var(--card-bg);
    color:var(--text-color);
    font-size:0.95rem;
}

.form-row {
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:10px;
}

button {
    cursor:pointer;
    font-weight:700;
    border:none;
    border-radius:12px;
    padding:0.85rem;
    color:white;
}

.btn-primary { background:var(--primary-color); }
.btn-accent { background:var(--accent-color); }
.btn-danger { background:var(--danger-color); }

.filter-group {
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:10px;
    margin-bottom:1rem;
}

.filter-group button { background:#888; }
.filter-group button.active { background:var(--primary-color); }

#taskList { list-style:none; padding:0; }

.task-card {
    background:var(--card-bg);
    padding:1.25rem;
    border-radius:16px;
    margin-bottom:1rem;
    border-left:6px solid #ccc;
    display:flex;
    flex-direction:column;
    gap:1rem;
}

.task-card.highlight {
    border:2px solid var(--primary-color);
    border-left-width:6px;
}

.completed {
    opacity:0.5;
    text-decoration:line-through;
}

.card-actions {
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:10px;
}

#performance-badge {
    background:var(--accent-color);
    color:white;
    padding:0.7rem 1.3rem;
    border-radius:50px;
    font-weight:700;
    margin-bottom:1rem;
    display:inline-block;
}
</style>
</head>
<body>

<div class="header">
    <h1>Senin Panelin</h1>
    <button class="btn-primary" onclick="toggleDarkMode()">Modu Değiştir</button>
</div>

<div class="form-container">
    <div class="input-group">
        <input id="title" placeholder="Görev adı.." autocomplete="off">
        <div class="form-row">
            <select id="priority">
                <option value="1">Düşük</option>
                <option value="3" selected>Orta</option>
                <option value="5">Yüksek</option>
            </select>
            <input id="duration" type="number" min="1" placeholder="Süre (dk)">
        </div>
        <input id="deadline" type="date">
        <button class="btn-accent" onclick="addTask()">Listeye Ekle</button>
    </div>
</div>

<button class="btn-primary" style="width:100%; margin-bottom:1rem;" onclick="highlightBestTask()">En Mantıklı Görevi Öner</button>

<div class="filter-group">
    <button id="filter-all" onclick="setFilter('all')">Hepsi</button>
    <button id="filter-today" onclick="setFilter('today')">Bugün</button>
    <button id="filter-week" onclick="setFilter('week')">Bu Hafta</button>
    <button id="filter-completed" onclick="setFilter('completed')">Bitenler</button>
</div>

<div id="performance-badge">
    Bugünkü Verimlilik Skoru:
    <span id="dailyScore">0</span>
</div>

<ul id="taskList"></ul>

<script>
let tasks = JSON.parse(localStorage.getItem("tasks")) || [];
let currentFilter = "all";

function saveTasks() {
    localStorage.setItem("tasks", JSON.stringify(tasks));
}

function toggleDarkMode() {
    const dark = document.body.classList.toggle("dark-mode");
    localStorage.setItem("darkMode", dark);
}
if(localStorage.getItem("darkMode")==="true") {
    document.body.classList.add("dark-mode");
}

function addTask() {
    const title = document.getElementById("title").value.trim();
    const duration = parseInt(document.getElementById("duration").value);
    const deadline = document.getElementById("deadline").value;
    const priority = parseInt(document.getElementById("priority").value);

    if (!title || !deadline || !duration || duration < 1) {
        alert("Tüm alanları doğru doldurun. Süre minimum 1 dakika olmalı.");
        return;
    }

    tasks.push({
        id: Date.now(),
        title,
        priority,
        duration,
        deadline,
        completed:false,
        completedAt:null
    });

    saveTasks();
    render();

    document.getElementById("title").value="";
    document.getElementById("duration").value="";
    document.getElementById("deadline").value="";
}

function calculateScore(task) {
    const today = new Date();
    today.setHours(0,0,0,0);

    const deadlineDate = new Date(task.deadline);
    deadlineDate.setHours(0,0,0,0);

    const diffDays = Math.floor((deadlineDate - today)/86400000);

    let urgency;

    if (diffDays < 0) {
        urgency = -10; // geçmiş görev ceza
    } else if (diffDays === 0) {
        urgency = 15;
    } else if (diffDays <= 3) {
        urgency = 8;
    } else if (diffDays <= 7) {
        urgency = 4;
    } else {
        urgency = 1;
    }

    let durationFactor = task.duration <= 30 ? 5 : 0;

    return (task.priority * 4) + urgency + durationFactor;
}

function highlightBestTask() {
    let best=null;
    let max=-Infinity;

    tasks.forEach(t=>{
        if(!t.completed){
            let s=calculateScore(t);
            if(s>max){
                max=s;
                best=t;
            }
        }
    });

    render(best?.id);
}

function setFilter(f){
    currentFilter=f;
    render();
}

function toggleTask(id){
    const todayStr=new Date().toISOString().split('T')[0];

    tasks=tasks.map(t=>{
        if(t.id===id){
            const newCompleted=!t.completed;
            return {
                ...t,
                completed:newCompleted,
                completedAt:newCompleted?todayStr:null
            };
        }
        return t;
    });

    saveTasks();
    render();
}

function deleteTask(id){
    if(confirm("Silmek istediğinize emin misiniz?")){
        tasks=tasks.filter(t=>t.id!==id);
        saveTasks();
        render();
    }
}

function render(highlightId=null){
    const list=document.getElementById("taskList");
    list.innerHTML="";

    const today=new Date();
    today.setHours(0,0,0,0);

    document.querySelectorAll('.filter-group button')
        .forEach(btn=>btn.classList.remove("active"));
    const active=document.getElementById(`filter-${currentFilter}`);
    if(active) active.classList.add("active");

    tasks.filter(t=>{
        const taskDate=new Date(t.deadline);
        taskDate.setHours(0,0,0,0);

        const diff=(taskDate-today)/86400000;

        if(currentFilter==="today")
            return diff===0 && !t.completed;

        if(currentFilter==="week")
            return diff>=0 && diff<=6 && !t.completed;

        if(currentFilter==="completed")
            return t.completed;

        return true;
    })
    .forEach(t=>{
        const li=document.createElement("li");
        li.className=`task-card ${t.completed?'completed':''} ${t.id===highlightId?'highlight':''}`;

        const info=document.createElement("div");

        const title=document.createElement("strong");
        title.textContent=t.title;

        const meta=document.createElement("small");
        meta.textContent=`Skor: ${calculateScore(t)} | Süre: ${t.duration} dk | Tarih: ${t.deadline}`;

        info.appendChild(title);
        info.appendChild(document.createElement("br"));
        info.appendChild(meta);

        const actions=document.createElement("div");
        actions.className="card-actions";

        const toggleBtn=document.createElement("button");
        toggleBtn.className="btn-primary";
        toggleBtn.textContent=t.completed?"Geri Al":"Bitir";
        toggleBtn.onclick=()=>toggleTask(t.id);

        const deleteBtn=document.createElement("button");
        deleteBtn.className="btn-danger";
        deleteBtn.textContent="Sil";
        deleteBtn.onclick=()=>deleteTask(t.id);

        actions.appendChild(toggleBtn);
        actions.appendChild(deleteBtn);

        li.appendChild(info);
        li.appendChild(actions);
        list.appendChild(li);
    });

    const todayStr=new Date().toISOString().split('T')[0];

    const perf=tasks.reduce((acc,t)=>{
        if(t.completed && t.completedAt===todayStr)
            return acc+calculateScore(t);
        return acc;
    },0);

    document.getElementById("dailyScore").textContent=perf;
}

render();
</script>
</body>
</html>
